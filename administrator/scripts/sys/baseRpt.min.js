var baseRpt=function(t,e,n,o){this.rptId=t;var i=t+"Module";_.contains(modulesD,i)||modulesD.push(i),this.rptModuleName=i,this.module=angular.module(this.rptModuleName,["ngRoute"]);var r=this;o||(o={}),o.onInit&&(r.init=o.onInit),o.onAfterLoadData&&(r.afterLoadData=o.onAfterLoadData),o.onDefaultCondition&&(r.defaultCondition=o.onDefaultCondition),o.onPrepareCondition&&(r.prepareCondition=o.onPrepareCondition),this.getUrl=function(){var t;return t=0==o.require_id_app?server_url+"/public/"+e:server_url+"/api/"+id_app+"/"+e},this.module.factory(t+"Config",function(){return{}}),this.getData=function(t,e,n,o,i){var a=r.getUrl()+"?t=1";i&&i.$emit("$dataChangeStart"),n&&angular.forEach(n,function(t,e){angular.isDate(t)?t=JSON.stringify(t).replace(/\"/g,""):angular.isObject(t)&&(t=JSON.stringify(t)),a=a+"&"+e+"="+encodeURI(t)}),t.get(a).success(function(t){o(null,t),i&&i.$emit("$dataChangeSuccess")}).error(function(t){console.log(t),o(t),i&&i.$emit("$dataChangeError")})},this.module.controller(t+"Controller",["$scope","$http","$filter","$location",t+"Config","$controller","$rootScope","$window","appInfo",function(e,i,a,c,l,s,d,u,p){var f=c.search();if(!e.condition){if(e.condition={},r.defaultCondition&&r.defaultCondition(e.condition),_.isEqual(f,{})&&l.condition)for(var h in l.condition)c.search(h,l.condition[h]),f[h]=l.condition[h];_.extend(e.condition,f)}r.init&&r.init(e,i,a,c,l,s),(0==o.require_id_app||1==p.info(t))&&(e.title=n,l.id_app==id_app&&_.isEqual(f,l.condition)&&(e.data=l.data),e.data?(e.condition_show=!1,r.afterLoadData&&r.afterLoadData(e,e.data)):e.condition_show=!0,e.hideCondition=function(){e.condition_show=!e.condition_show},e.viewVoucher=function(t,e){if(t&&e){var n=t.toLowerCase()+"/edit/"+e+"?redirect=back";c.url(n)}},e.order=function(t,n){e.data=a("orderBy")(e.data,t,n)},e.getData=function(){o.onStartGetData?o.onStartGetData(e,function(t){t?alert(t):e.getDataFromServer()}):e.getDataFromServer()},e.getDataFromServer=function(){e.data=[];for(var t in e.condition){var n=e.condition[t];angular.isDate(n)&&(n=a("date")(n,"yyyy-MM-dd")),n&&""!=n&&c.search(t,n)}r.prepareCondition?r.prepareCondition(e.condition,a,function(t,n){t?e.error=t:r.getData(i,a,n,function(t,n){e.data=n,e.error=t,t||(e.condition_show=!1,l.condition=c.search(),l.data=n,l.id_app=id_app,r.afterLoadData&&r.afterLoadData(e,n))},e)}):r.getData(i,a,e.condition,function(t,n){e.data=n,e.error=t,t||(e.condition_show=!1,l.condition=c.search(),l.data=n,l.id_app=id_app,r.afterLoadData&&r.afterLoadData(e,n))},e)},e.print=function(){c.path("/"+t+"/print")},e.exportExcel=function(){var t=r.getUrl()+"/excel?access_token="+access_token;r.prepareCondition?r.prepareCondition(e.condition,a,function(n,o){n?e.error=n:(angular.forEach(o,function(e,n){angular.isDate(e)&&(e=a("date")(e,"yyyy-MM-dd")),angular.isObject(e)&&(e=JSON.stringify(e)),e&&(t=t+"&"+n+"="+encodeURI(e))}),u.open(t))}):(angular.forEach(e.condition,function(e,n){angular.isDate(e)&&(e=a("date")(e,"yyyy-MM-dd")),angular.isObject(e)&&(e=JSON.stringify(e)),e&&(t=t+"&"+n+"="+encodeURI(e))}),u.open(t))},o.onLoading&&o.onLoading(e,{$http:i,$filter:a,$location:c,$config:l,$controller:s}),e.condition.isDrillDown&&(delete e.condition.isDrillDown,e.getData()),e.isLike=!1,id_app&&(i.get(server_url+"/api/"+id_app+"/like_module?q={module:'"+t+"'}").success(function(t){t&&1==t.length&&(e.isLike=t[0].like)}).error(function(t){console.log(t)}),e.like=function(){var n=server_url+"/api/"+id_app+"/like_module";i.post(n,{id_app:id_app,module:t,like:!0}).success(function(t){t&&(e.isLike=!0)}).error(function(t){console.log(t)})},e.unlike=function(){var n=server_url+"/api/"+id_app+"/like_module";i.post(n,{id_app:id_app,module:t,like:!1}).success(function(t){t&&(e.isLike=!1)}).error(function(t){console.log(t)})}),e.$on("keydown",function(t,n){if(116==n.which)return void e.getData();if(n.ctrlKey){if(69==n.which)return void e.exportExcel();if(80==n.which)return void e.print()}}))}]),this.module.controller(t+"PrintController",["$controller","appInfo","$scope",t+"Config","$timeout","$location","$rootScope",function(e,o,i,a,c,l,s){o.info(t,function(o,d,u){o||(i.parameters={},i.condition=a.condition,i.title=n,i.data=a.data,i.appInfo=u,r.setParameters&&r.setParameters(i,e),i.print=function(){i.printing=!0,s.printing=!0,c(function(){window.print(),i.printing=!1,s.printing=!1},100)},i.back=function(){l.url("/"+t)},i.$on("keydown",function(t,e){return e.ctrlKey&&80==e.which?void i.print():void 0}))})}]),this.module.config(["$routeProvider","$locationProvider",function(e){e.when("/"+t,{templateUrl:"templates/reports/"+t+"/templates/browser.html",controller:t+"Controller",reloadOnSearch:!1}).when("/"+t+"/print",{templateUrl:"templates/reports/"+t+"/templates/print.html",controller:t+"PrintController",reloadOnSearch:!1})}])};
//# sourceMappingURL=baseRpt.min.js.map