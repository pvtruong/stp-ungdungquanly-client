var viewProfile=function(t,e){t.open({templateUrl:"templates/sys/profile.html",controller:["$scope","$modalInstance","user","$location","$rootScope",function(t,n,o,i,r){o.getProfile(e,function(e,n){t.profile=n}),t.cancel=function(){n.dismiss("cancel")},t.gotoChat=function(t){n.dismiss("cancel"),i.path("/message/chat/"+t)},t.currentUser=r.user}],size:"lg"})},baseInput=function(t,e,n,o,i){this.code=t,this.server_path=e,this.fields_find=n,this.title=o,i||(i={}),this.options=i,this.group=i.group,this.group||(this.group="lists"),this.defaultConditions=i.defaultConditions,this.defaultValues=i.defaultValues,this.loading=i.onLoading,this.initHomeController=i.onInitHomeController,this.initAddController=i.onInitAddController,this.initEditController=i.onInitEditController,this.init=i.onInit,this.setDataSource2Print=i.onSetDataSource2Print,this.loadItem=i.onLoadItem,this.initImport=i.onImport;var r=t+"Module";_.contains(modulesD,r)||modulesD.push(r),this.module=angular.module(r,["ngRoute"]);var a=this;this.module.factory(t+"Config",function(){return{title:o,path:t}}),this.module.factory(t,["$http",function(t){var o=function(){var t;return t=_.contains(paths_not_require_id_app,e)?server_url+"/api/"+e:server_url+"/api/"+id_app+"/"+e};return baseService(t,o,n,i.services)}]),this.module.controller(t+"JsonController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$window","$interval","$modal","$filter","appInfo","$localStorage",function(e,n,o,r,c,l,s,u,d,p,f,m){n.list=[],n.condition="",a.defaultConditions&&(n.condition={},_.extend(n.condition,a.defaultConditions)),angular.extend(n,l),n.limit=3e4;var h=c.search();m.info(t,function(t){t||(n.list=[],r.load(id_app,{condition:n.condition,filter:n.filter,page:1,limit:n.limit,queryParams:h,onCondition:i.onCondition}).success(function(t){n.list=t}).error(function(t){t&&alert(t)}))})}]),this.module.controller(t+"HomeController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$window","$interval","$modal","$filter","appInfo","$localStorage",function(e,n,o,r,c,l,s,u,d,p,f,m,h){n.list=[],n.condition="",a.defaultConditions&&(n.condition={},_.extend(n.condition,a.defaultConditions)),angular.extend(n,l),n.total_page=1,n.current_page=1,n.pages=[1],n.limit=30,n.$modal=p,n.$http=o,n.config=l;var g=c.search();a.init&&a.init(n,e),m.info(t,function(m,$){if(!m){var v=(id_app||"")+$.email+t+"data";a.loading&&s.nextTick(function(){a.loading(n,{$controller:e,$http:o,service:r,$location:c,config:l,$rootScope:s,$window:u,$interval:d,$modal:p})}),n.current_user=s.user,n.goToPage=function(t,e,a){s.nextTick(function(){if(n.$emit("$dataChangeStart"),n.list=[],e||void 0!=e||(e=n.condition),n.findBy&&!_.isObject(e)){var c=e;e={},e[n.findBy]={$regex:c,$options:"i"}}r.load(id_app,{condition:e,filter:n.filter,count:1,queryParams:g,onCondition:i.onCondition}).success(function(t){n.total_page=Math.round(t.rows_number/n.limit,0),n.total_page<t.rows_number/n.limit&&(n.total_page+=1),0==n.total_page&&(n.total_page=1),n.pages=[];for(var e=1;e<=n.total_page;e++)n.pages.push(e)}),r.load(id_app,{condition:e,filter:n.filter,page:t,limit:n.limit,queryParams:g,onCondition:i.onCondition}).success(function(i){async.map(i,function(t,e){id_app?o.get(server_url+"/api/"+id_app+"/follow?q={id_object:'"+t._id+"',user_created:'"+n.current_user.email+"'}").success(function(n){n&&n.length>0?(t.followObject=n[0],t.follow_yn=1):t.follow_yn=0,e()}).error(function(n){t.follow_yn=0,e(n)}):e()},function(o){o&&console.log(o),l.list=i,h.setObject(v,i),l.id_app=id_app,l.current_page=t,l.condition=e,l.filter=n.filter,l.filter_title=n.filter_title,n.current_page=t,n.list=i,n.renderCompleted=!0,a&&a(null,n.list),n.$emit("$dataChangeSuccess")})}).error(function(t){console.log(t),n.$emit("$dataChangeError"),a&&a(t)})})},l.list&&0!=l.list.length&&id_app&&l.id_app==id_app?(n.list=[],s.nextTick(function(){n.$emit("$dataChangeStart"),condition=l.condition,n.filter=l.filter,n.list=l.list,n.current_page=l.current_page,n.current_page||(n.current_page=1),r.load(id_app,{condition:condition,filter:n.filter,count:1,queryParams:g,onCondition:i.onCondition}).success(function(t){n.total_page=Math.round(t.rows_number/n.limit,0),n.total_page<t.rows_number/n.limit&&(n.total_page+=1),0==n.total_page&&(n.total_page=1),n.pages=[];for(var e=1;e<=n.total_page;e++)n.pages.push(e);n.$emit("$dataChangeSuccess"),n.renderCompleted=!0}).error(function(){n.$emit("$dataChangeError"),n.renderCompleted=!0})})):n.goToPage(1,null,function(t){t&&s.nextTick(function(){var t=h.getObject(v);n.list&&0!=n.list.length||(n.list=t,n.current_page=1,n.total_page=1),n.renderCompleted=!0})}),n.update=function(t){n.$emit("$dataSaveStart"),r.update(id_app,t._id,t).success(function(){t.updated=!0,n.$emit("$dataSaveSuccess"),alert("Đã cập nhật thành công")}).error(function(t){n.$emit("$dataSaveError");var e=JSON.stringify(t);if(e.indexOf("Lỗi")<0){if(e.indexOf("duplicate")>=0)return e="Lỗi: Đã tồn tại",alert(e);if(e.indexOf("Not allowed")>=0)return e="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(e)}e=JSON.parse(e),alert(angular.isArray(e)?e.join("\n"):e)})},n.add=function(){var t="/"+n.path+"/add";c.path(t)},n.edit=function(t){c.path("/"+n.path+"/edit/"+t)},n.view=function(t){c.path("/"+n.path+"/view/"+t)},n.openProfile=function(t){viewProfile(p,t)},n.searchKeyup=function(t){13==t.keyCode&&n.search()},n.search=function(t){n.renderCompleted&&n.goToPage(1,t)},n.changeFilter=function(t){n.findBy=null,n.filter=t.filter,n.filter_title=t.title,n.search()},n.changeFindBy=function(t){n.filter=null,n.findBy=t.findBy,n.filter_title=t.title,n.search()},n.location=c.url(),n.reverse=!0,n.order=function(t,e){n.list=f("orderBy")(n.list,t,e)},n.selectionAll=!1,n.$watch("selectionAll",function(t){n.list&&n.list.forEach(function(e){e.sel=t})}),n.isUnSelected=function(){if(!n.list)return!0;for(var t=0;t<n.list.length;t++){var e=n.list[t];if(e.sel&&1==e.sel)return!1}return!0},n.delete=function(t){t?confirm("Có chắc chắn xóa không?")&&r.delete(id_app,t).success(function(){n.list=_.reject(n.list,function(e){return e._id==t}),l.list=n.list}).error(function(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")}):confirm("Có chắc chắn xóa những dòng đã chọn không?")&&async.map(n.list,function(t,e){if(t.sel&&1==t.sel){var o=t._id;r.delete(id_app,o).success(function(){n.list=_.reject(n.list,function(t){return t._id==o}),e(null,o)}).error(function(t){e(t)})}else e()},function(t){if(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")}else l.list=n.list})},a.initHomeController&&a.initHomeController(e,n,o,r,c,l),id_app&&s.nextTick(function(){var e=server_url+"/api/"+id_app+"/rpt?q={ma_cn:'"+t.toUpperCase()+"'}";o.get(e).success(function(t){n.rpts=t}).error(function(t){console.log(t)})}),n.rptManagement=function(){var e="rpt?ma_cn="+t.toUpperCase();c.url(e)},n.print=function(e){n.list.forEach(function(n){if(n.sel){var o=server_url+"/api/"+id_app+"/"+t+"/excel/"+e+"?_id="+n._id+"&access_token="+s.token;u.open(o)}})},n.import=function(){var e="#"+t+"/import?t=1";if(a.initImport)a.initImport(n,e,function(t,e){if(t)return u.alert(t);var o=0,i=u.open(e,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=d(function(){return"OK"==i.document.title?(n.search(),d.cancel(stop),stop=void 0,void i.close()):"ERROR"==i.document.title?(d.cancel(stop),void(stop=void 0)):(o+=500,void(o>3e5&&stop&&(d.cancel(stop),stop=void 0)))},500)});else{var o=0,i=u.open(e,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=d(function(){return"OK"==i.document.title?(n.search(),d.cancel(stop),stop=void 0,void i.close()):"ERROR"==i.document.title?(d.cancel(stop),void(stop=void 0)):(o+=500,void(o>3e5&&stop&&(d.cancel(stop),stop=void 0)))},500)}},n.follow=function(e){1==e.follow_yn?o.delete(server_url+"/api/"+id_app+"/follow/"+e.followObject._id).success(function(){e.follow_yn=0}).error(function(t){t&&u.alert(t)}):(followObject={id_object:e._id,collection_name:t,id_app:id_app},o.post(server_url+"/api/"+id_app+"/follow",followObject).success(function(t){e.followObject=t,e.follow_yn=1}).error(function(t){t&&u.alert(t)}))},n.isLike=!1,id_app&&(o.get(server_url+"/api/"+id_app+"/like_module?q={module:'"+t+"',user_created:'"+$.email+"'}").success(function(t){t&&1==t.length&&(n.isLike=t[0].like)}).error(function(t){console.log(t)}),n.like=function(){var e=server_url+"/api/"+id_app+"/like_module";o.post(e,{id_app:id_app,module:t,like:!0}).success(function(t){t&&(n.isLike=!0)}).error(function(t){console.log(t)})},n.unlike=function(){var e=server_url+"/api/"+id_app+"/like_module";o.post(e,{id_app:id_app,module:t,like:!1}).success(function(t){t&&(n.isLike=!1)}).error(function(t){console.log(t)})}),n.$on("keydown",function(t,e){return 116==e.which?void n.search():e.ctrlKey&&77==e.which?void n.add():e.ctrlKey&&68==e.which?void n.delete():(e.ctrlKey&&65==e.which&&n.list&&n.list.forEach(function(t){t.sel=!0}),void(e.ctrlKey&&85==e.which&&n.list&&n.list.forEach(function(t){t.sel=!1})))}),n.options=function(){token=s.token;p.open({templateUrl:"templates/"+a.group+"/"+t+"/templates/options.html",controller:["$scope","$controller","$http","$modalInstance","$window",function(e,n,o,i){var r=server_url+"/api/"+id_app+"/options",a={};o.get(r+"?access_token="+token+"&q={id_func:'"+t+"'}").success(function(n){1==n.length?(a=n[0],e.options=a.option):(a.id_app=id_app,a.id_func=t)}).error(function(){console.log(r)}),e.save=function(){a.option=e.options,a._id?o.put(r+"/"+a._id+"?access_token="+token,a).success(function(){i.close()}).error(function(t){alert("Không thể cập nhật tùy chọn\n"+t.toString())}):o.post(r+"?access_token="+token,a).success(function(){i.close()}).error(function(t){alert("Không thể lưu tùy chọn\n"+t.toString())})},e.cancel=function(){i.dismiss("cancel")}}],size:"lg",resolve:{}})}}})}]),this.module.directive(t+"Form",[function(){return{restrict:"E",templateUrl:"templates/"+a.group+"/"+t+"/templates/form.html"}}]),this.module.controller(t+"ImportController",["$scope","$rootScope","$location","$routeParams",t+"Config","appInfo",function(e,n,o,i,r,c){c.info(t,function(t){if(!t){var i=n.token;n.hide_nav=!0,e.action=server_url+"/api/"+id_app+"/"+a.server_path+"/import/excel?access_token="+i,e.template="templates/templates/"+a.code+".xlsx";var r=o.search();r.values&&(e.action=e.action+"&values="+r.values),r.update&&(e.action=e.action+"&update="+r.update)}})}]),this.module.controller(t+"AddController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$modal","$window","appInfo",function(e,n,o,r,c,l,s,u,d,p){n.masterData={status:!0},n.data={status:!0,visible_to:0},n.$modal=u,n.$http=o,n.$window=d,a.defaultValues&&(_.extend(n.data,a.defaultValues),_.extend(n.masterData,a.defaultValues));var f=c.search();f&&(_.extend(n.data,f),_.extend(n.masterData,f)),a.init&&a.init(n,e),n.action="Thêm mới",p.info(t,function(t){if(!t){n.current_user=s.user,n.isDataLoaded=!0,angular.extend(n,l),i.onAdd&&s.nextTick(function(){i.onAdd(n,{$controller:e,$rootScope:s,$http:o,service:r,$location:c,config:l,$window:d,$modal:u})}),n.reset=function(){n.data=angular.copy(n.masterData)},n.cancel=function(){var t=c.search().redirect;t?"back"==t?d.history.back():c.url(t):c.url("/"+n.path)},n.isUnchanged=function(){return angular.equals(n.data,n.masterData)};var p=function(){n.$emit("$dataSaveStart"),r.create(id_app,n.data).success(function(t){n.masterData=t,l.list||(l.list=[]),l.list.push(n.masterData);var e=c.search().redirect;e?"back"==e?d.history.back():c.url(e):i.has_view?c.url("/"+n.path+"/view/"+t._id):c.path("/"+n.path),n.$emit("$dataSaveSuccess")}).error(function(t){n.$emit("$dataSaveError");var e=t;e.indexOf("Lỗi")<0&&(e.indexOf("duplicate")>=0?e="Lỗi: Đã tồn tại":e.indexOf("Not allowed")>=0&&(e="Lỗi: Bạn không có quyền thực hiện thao tác này")),alert(angular.isArray(e)?e.join("\n"):e)})};n.create=function(){i.onSave?i.onSave(n,n.data,{action:"CREATE",$controller:e,$rootScope:s,$http:o,service:r,$location:c,config:l,$window:d,$modal:u},function(t,e){return t?d.alert(t):void(e&&p())}):p()},n.$on("keydown",function(t,e){e.ctrlKey&&83==e.which&&n.create()}),a.initAddController&&a.initAddController(e,n,o,r,c,l)}})}]),this.quickadd=function(e,n,o){e.open({templateUrl:"templates/"+a.group+"/"+t+"/templates/dialog-quickadd.html",controller:["$scope","$controller","$http",t,"$location",t+"Config","$modalInstance","$window","$rootScope",function(t,r,c,l,s,u,d,p,f){if(t.masterData={status:!0},t.data={status:!0,visible_to:0},t.isDataLoaded=!0,t.$modal=e,t.$http=c,t.$window=p,t.action="Thêm mới",a.init&&a.init(t,r),a.defaultValues&&_.extend(t.data,a.defaultValues),o)for(var m in o)t.data[m]=o[m];var h=s.search();h&&(_.extend(t.data,h),_.extend(t.masterData,h)),angular.extend(t,u),a.initAddController&&a.initAddController(r,t,c,l,s,u),t.isUnchanged=function(){return angular.equals(t.data,t.masterData)},i.onAdd&&f.nextTick(function(){i.onAdd(t,{$controller:r,$rootScope:f,$http:c,service:l,$location:s,config:u,$window:p,$modal:e})});var g=function(){t.$emit("$dataSaveStart"),l.create(id_app,t.data).success(function(e){t.masterData=e,u.list||(u.list=[]),u.list.push(t.masterData),n&&n(t.masterData),d.close(),t.$emit("$dataSaveSuccess")}).error(function(e){t.$emit("$dataSaveError");var n=e;n.indexOf("Lỗi")<0&&(n.indexOf("duplicate")>=0?n="Lỗi: Đã tồn tại":n.indexOf("Not allowed")>=0&&(n="Lỗi: Bạn không có quyền thực hiện thao tác này")),alert(angular.isArray(n)?n.join("\n"):n)})};t.create=function(){i.onSave?i.onSave(t,t.data,{action:"CREATE",$controller:r,$rootScope:f,$http:c,service:l,$location:s,config:u,$window:p,$modal:e},function(t,e){return t?p.alert(t):void(e&&g())}):g()},t.cancel=function(){d.dismiss("cancel")}}],size:"lg",backdrop:"static",resolve:{}})},this.quickedit=function(e,n,o){e.open({templateUrl:"templates/"+a.group+"/"+t+"/templates/dialog-quickadd.html",controller:["$scope","$controller","$http",t,"$location",t+"Config","$modalInstance","$window","$routeParams","$timeout","$rootScope",function(t,r,c,l,s,u,d,p,f,m,h){t.data={},a.init&&a.init(t,r),h.nextTick(function(){l.get(id_app,n).success(function(g){if(!g)return p.alert("Đối tượng này không tồn tại\nid:"+n),void d.dismiss("cancel");t.masterData=g,_.extend(t.data,g),t.$modal=e,t.$http=c,t.$window=p,t.action="Sửa",a.loadItem&&a.loadItem(t,t.data),m(function(){t.isDataLoaded=!0},100),angular.extend(t,u),t.isUnchanged=function(){return angular.equals(t.data,t.masterData)},i.onEdit&&h.nextTick(function(){i.onEdit(t,{$controller:r,$rootScope:h,$http:c,service:l,$location:s,config:u,$window:p,$modal:e})});var $=function(){t.$emit("$dataSaveStart"),l.update(id_app,n,t.data).success(function(e){for(var n in e)t.masterData[n]=e[n];o&&o(t.masterData),d.close(),t.$emit("$dataSaveSuccess")}).error(function(e){t.$emit("$dataSaveError");var n=JSON.stringify(e);if(n.indexOf("Lỗi")<0){if(n.indexOf("duplicate")>=0)return n="Lỗi: Đã tồn tại",alert(n);if(n.indexOf("Not allowed")>=0)return n="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(n)}n=JSON.parse(n),alert(angular.isArray(n)?n.join("\n"):n)})};t.create=function(){i.onSave?i.onSave(t,t.data,{action:"UPDATE",$controller:r,$rootScope:h,$http:c,service:l,$location:s,config:u,$window:p,$modal:e},function(t,e){return t?p.alert(t):void(e&&$())}):$()},t.cancel=function(){d.dismiss("cancel")},a.initEditController&&a.initEditController(r,t,c,l,s,f,u,m)}).error(function(t){alert(t.indexOf("Lỗi")>=0?t:"Không thể tìm thấy đối tượng này"),d.dismiss("cancel")})})}],size:"lg",backdrop:"static",resolve:{}})},this.module.controller(t+"EditController",["$controller","$scope","$http",t,"$location","$routeParams",t+"Config","$timeout","$rootScope","$modal","$window","appInfo",function(e,n,o,r,c,l,s,u,d,p,f,m){n.masterData=null,n.data={},n.$modal=p,n.$http=o,n.$window=f,n.action="Sửa",angular.extend(n,s),a.init&&a.init(n,e),m.info(t,function(t){if(!t){n.current_user=d.user,s.list&&(n.masterData=_.find(s.list,function(t){return t._id==l.id})),n.openProfile=function(t){viewProfile(p,t)},n.masterData?(n.data=angular.copy(n.masterData),a.loadItem&&a.loadItem(n,n.data),i.onEdit&&d.nextTick(function(){i.onEdit(n,{$controller:e,$http:o,service:r,$location:c,config:s,$window:f,$modal:p})}),u(function(){n.isDataLoaded=!0},100)):(n.masterData={},d.nextTick(function(){n.$emit("$dataChangeStart"),r.get(id_app,l.id).success(function(t){n.masterData=t,n.data=angular.copy(n.masterData),s.list||(s.list=[]),s.list.push(n.masterData),a.loadItem&&a.loadItem(n,n.data),i.onEdit&&d.nextTick(function(){i.onEdit(n,{$controller:e,$rootScope:d,$http:o,service:r,$location:c,config:s,$window:f,$modal:p})}),u(function(){n.isDataLoaded=!0,n.$emit("$dataChangeSuccess")},100)}).error(function(t){n.$emit("$dataChangeError"),alert(t.indexOf("Lỗi")>=0?t:"Không thể tìm thấy đối tượng này")})})),n.isUnchanged=function(){return angular.equals(n.data,n.masterData)},n.reset=function(){n.data=angular.copy(n.masterData)},n.cancel=function(){var t=c.search().redirect;t?"back"==t?f.history.back():c.url(t):c.url(i.has_view?"/"+n.path+"/view/"+n.data._id:"/"+n.path)},n.$on("keydown",function(t,e){e.ctrlKey&&83==e.which&&n.create()});var m=function(){n.$emit("$dataSaveStart"),r.update(id_app,l.id,n.data).success(function(t){for(var e in t)n.masterData[e]=t[e];var o=c.search().redirect;o?"back"==o?f.history.back():c.url(o):i.has_view?c.url("/"+n.path+"/view/"+t._id):c.path("/"+n.path),n.$emit("$dataSaveSuccess")}).error(function(t){n.$emit("$dataSaveError");var e=JSON.stringify(t);if(e.indexOf("Lỗi")<0){if(e.indexOf("duplicate")>=0)return e="Lỗi: Đã tồn tại",alert(e);if(e.indexOf("Not allowed")>=0)return e="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(e)}e=JSON.parse(e),alert(angular.isArray(e)?e.join("\n"):e)})};n.create=function(){i.onSave?i.onSave(n,n.data,{action:"UPDATE",$controller:e,$rootScope:d,$http:o,service:r,$location:c,config:s,$window:f,$modal:p},function(t,e){return t?f.alert(t):void(e&&m())}):m()},a.initEditController&&a.initEditController(e,n,o,r,c,l,s,u)}})}]),this.module.controller(t+"ViewController",["$controller","$scope","$routeParams",t+"Config",t,"$rootScope","$location","$window","$http","$modal","appInfo","$localStorage","$interval",function(e,n,o,r,a,c,l,s,u,d,p,f,m){p.info(t,function(p){if(!p){n.code=t,n.location=l.url(),n.current_user=c.user,n.action="Xem",n.current_record=0,n.total_records=0,angular.extend(n,r);var h=function(){c.nextTick(function(){n.$emit("$dataChangeStart"),a.get(id_app,o.id).success(function(t){n.data=t,n.data.links=[],id_app&&u.get(server_url+"/api/"+id_app+"/follow?q={id_object:'"+t._id+"',user_created:'"+n.current_user.email+"'}").success(function(e){e&&e.length>0?(t.followObject=e[0],t.follow_yn=1):t.follow_yn=0}).error(function(){t.follow_yn=0}),i.onView&&i.onView(n,{$controller:e,$http:u,service:a,$location:l,config:r,$window:s,$modal:d,$rootScope:c,$localStorage:f,$interval:m}),n.$emit("$dataChangeSuccess")}).error(function(t){t&&alert(t),n.$emit("$dataChangeError"),l.url("/"+n.path)})})};if(n.list)for(var g=0;g<n.list.length;g++)if(n.list[g]._id==o.id){n.current_record=g,n.total_records=n.list.length-1,n.data=n.list[n.current_record],n.data.links=[],i.onView&&i.onView(n,{$controller:e,$http:u,service:a,$location:l,config:r,$window:s,$modal:d,$rootScope:c,$localStorage:f,$interval:m});break}n.data||h(),n.back=function(){var t=l.search().redirect;t?"back"==t?s.history.back():l.url(t):l.url("/"+n.path)},n.update=function(t,e){var o={};_.extend(o,n.data),t&&_.extend(o,t),a.update(id_app,n.data._id,o).success(function(t){_.extend(n.data,t),e&&e(null,t)}).error(function(t){e?e(t):t&&s.alert(t)})},n.edit=function(){l.url("/"+t+"/edit/"+o.id)},n.add=function(){var t="/"+n.path+"/add";l.path(t)},n.backRecord=function(){if(n.current_record>0){n.current_record=n.current_record-1;var e=n.list[n.current_record]._id;l.path(t+"/view/"+e)}},n.nextRecord=function(){if(n.list&&n.current_record<n.total_records){n.current_record=n.current_record+1;var e=n.list[n.current_record]._id;l.path(t+"/view/"+e)}},n.delete=function(t){confirm("Có chắc chắn xóa không?")&&a.delete(id_app,t).success(function(){r.list=_.reject(r.list,function(e){return e._id==t});var e=l.search().redirect;e?"back"==e?s.history.back():l.url(e):l.url("/"+n.path)}).error(function(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")})},n.openProfile=function(t){viewProfile(d,t)},n.follow=function(){1==n.data.follow_yn?u.delete(server_url+"/api/"+id_app+"/follow/"+n.data.followObject._id).success(function(){n.data.follow_yn=0}).error(function(t){t&&s.alert(t)}):(followObject={id_object:n.data._id,collection_name:t,id_app:id_app},u.post(server_url+"/api/"+id_app+"/follow",followObject).success(function(t){n.data.followObject=t,n.data.follow_yn=1}).error(function(t){t&&s.alert(t)}))},n.$on("keydown",function(t,e){if(116==e.which)return void h();if(e.ctrlKey){if(69==e.which)return void n.edit();if(77==e.which)return void n.add()}}),n.addLink=function(e,o){var i={};i.id_a=n.data._id,i.collection_a=t,i.collection_b=e.collection_name,i.id_b=e._id;var r=server_url+"/api/"+id_app+"/link";u.post(r,i).success(function(t){_.extend(i,t),i.obj=e,i.collection_obj=e.collection_name,i.title=e[o],n.data.links.push(i)}).error(function(t){console.log(t);var r={id_a:i.id_a,id_b:i.id_b};u.get(server_url+"/api/"+id_app+"/link?q="+JSON.stringify(r)).success(function(t){t.length>0&&(_.extend(i,t[0]),i.obj=e,i.collection_obj=e.collection_name,i.title=e[o],n.data.links.push(i))}).error(function(t){console.error(t)})})}}})}]),this.module.config(["$routeProvider","$locationProvider",function(e){e.when("/"+t,{templateUrl:"templates/"+a.group+"/"+t+"/templates/list.html",controller:t+"HomeController"}).when("/"+t+"/add",{templateUrl:"templates/"+a.group+"/"+t+"/templates/edit.html",controller:t+"AddController"}).when("/"+t+"/json",{templateUrl:"templates/sys/json.html",controller:t+"JsonController"}).when("/"+t+"/import",{templateUrl:"templates/sys/import.html",controller:t+"ImportController"}).when("/"+t+"/edit/:id",{templateUrl:"templates/"+a.group+"/"+t+"/templates/edit.html",controller:t+"EditController"}).when("/"+t+"/view/:id",{templateUrl:"templates/"+a.group+"/"+t+"/templates/view.html",controller:t+"ViewController"})}]),this.initModule&&this.initModule(this.module)};
//# sourceMappingURL=baseInput.min.js.map