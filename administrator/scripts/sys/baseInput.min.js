var viewProfile=function(t,e){t.open({templateUrl:"templates/sys/profile.html",controller:["$scope","$modalInstance","user","$location","$rootScope",function(t,n,i,a,o){i.getProfile(e,function(e,n){t.profile=n}),t.cancel=function(){n.dismiss("cancel")},t.gotoChat=function(t){n.dismiss("cancel"),a.path("/message/chat/"+t)},t.currentUser=o.user}],size:"lg"})},baseInput=function(t,e,n,i,a){this.code=t,this.server_path=e,this.fields_find=n,this.title=i,a||(a={}),this.options=a,this.group=a.group,this.group||(this.group="lists"),this.defaultConditions=a.defaultConditions,this.defaultValues=a.defaultValues,this.loading=a.onLoading,this.initHomeController=a.onInitHomeController,this.initAddController=a.onInitAddController,this.initEditController=a.onInitEditController,this.init=a.onInit,this.setDataSource2Print=a.onSetDataSource2Print,this.loadItem=a.onLoadItem,this.initImport=a.onImport;var o=t+"Module";_.contains(modulesD,o)||modulesD.push(o),this.module=angular.module(o,["ngRoute"]);var r=this;this.module.factory(t+"Config",function(){return{title:i,path:t}}),this.module.factory(t,["$http",function(t){var i=function(){var t;return t=_.contains(paths_not_require_id_app,e)?server_url+"/api/"+e:server_url+"/api/"+id_app+"/"+e};return baseService(t,i,n,a.services)}]),this.module.controller(t+"JsonController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$window","$interval","$modal","$filter","appInfo","$localStorage",function(e,n,i,o,c,l,d,u,s,p,h,f){n.list=[],n.condition="",r.defaultConditions&&(n.condition={},_.extend(n.condition,r.defaultConditions)),angular.extend(n,l),n.limit=3e4;var g=c.search();f.info(t,function(t){t||(n.list=[],o.load(id_app,{condition:n.condition,filter:n.filter,page:1,limit:n.limit,queryParams:g,onCondition:a.onCondition}).success(function(t){n.list=t}).error(function(t){t&&alert(t)}))})}]),this.module.controller(t+"HomeController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$window","$interval","$modal","$filter","appInfo","$localStorage",function(e,n,i,o,c,l,d,u,s,p,h,f,g){n.list=[],n.condition="",r.defaultConditions&&(n.condition={},_.extend(n.condition,r.defaultConditions)),angular.extend(n,l),n.total_page=1,n.current_page=1,n.pages=[1],n.limit=30,n.$modal=p,n.$http=i,n.config=l;var m=c.search();r.init&&r.init(n,e),f.info(t,function(f,v){if(!f){var $=(id_app||"")+v.email+t+"data";r.loading&&d.nextTick(function(){r.loading(n,{$controller:e,$http:i,service:o,$location:c,config:l,$rootScope:d,$window:u,$interval:s,$modal:p})}),n.current_user=d.user,n.goToPage=function(t,e,r){d.nextTick(function(){if(n.$emit("$dataChangeStart"),n.list=[],e||void 0!=e||(e=n.condition),n.findBy&&!_.isObject(e)){var c=e;e={},e[n.findBy]={$regex:c,$options:"i"}}o.load(id_app,{condition:e,filter:n.filter,count:1,queryParams:m,onCondition:a.onCondition}).success(function(t){n.total_page=Math.round(t.rows_number/n.limit,0),n.total_page<t.rows_number/n.limit&&(n.total_page+=1),0==n.total_page&&(n.total_page=1),n.pages=[];for(var e=1;e<=n.total_page;e++)n.pages.push(e)}),o.load(id_app,{condition:e,filter:n.filter,page:t,limit:n.limit,queryParams:m,onCondition:a.onCondition}).success(function(a){async.map(a,function(t,e){id_app?i.get(server_url+"/api/"+id_app+"/follow?q={id_object:'"+t._id+"',user_created:'"+n.current_user.email+"'}").success(function(n){n&&n.length>0?(t.followObject=n[0],t.follow_yn=1):t.follow_yn=0,e()}).error(function(n){t.follow_yn=0,e(n)}):e()},function(i){i&&console.log(i),l.list=a,g.setObject($,a),l.id_app=id_app,l.current_page=t,l.condition=e,l.filter=n.filter,l.filter_title=n.filter_title,n.current_page=t,n.list=a,n.renderCompleted=!0,r&&r(null,n.list),n.$emit("$dataChangeSuccess")})}).error(function(t){console.log(t),n.$emit("$dataChangeError"),r&&r(t)})})},l.list&&0!=l.list.length&&id_app&&l.id_app==id_app?(n.list=[],d.nextTick(function(){n.$emit("$dataChangeStart"),condition=l.condition,n.filter=l.filter,n.list=l.list,n.current_page=l.current_page,n.current_page||(n.current_page=1),o.load(id_app,{condition:condition,filter:n.filter,count:1,queryParams:m,onCondition:a.onCondition}).success(function(t){n.total_page=Math.round(t.rows_number/n.limit,0),n.total_page<t.rows_number/n.limit&&(n.total_page+=1),0==n.total_page&&(n.total_page=1),n.pages=[];for(var e=1;e<=n.total_page;e++)n.pages.push(e);n.$emit("$dataChangeSuccess"),n.renderCompleted=!0}).error(function(){n.$emit("$dataChangeError"),n.renderCompleted=!0})})):n.goToPage(1,null,function(t){t&&d.nextTick(function(){var t=g.getObject($);n.list&&0!=n.list.length||(n.list=t,n.current_page=1,n.total_page=1),n.renderCompleted=!0})}),n.update=function(t){n.$emit("$dataSaveStart"),o.update(id_app,t._id,t).success(function(){t.updated=!0,n.$emit("$dataSaveSuccess"),alert("Đã cập nhật thành công")}).error(function(t){n.$emit("$dataSaveError");var e=JSON.stringify(t);if(e.indexOf("Lỗi")<0){if(e.indexOf("duplicate")>=0)return e="Lỗi: Đã tồn tại",alert(e);if(e.indexOf("Not allowed")>=0)return e="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(e)}e=JSON.parse(e),alert(angular.isArray(e)?e.join("\n"):e)})},n.add=function(){var t="/"+n.path+"/add";c.path(t)},n.edit=function(t){c.path("/"+n.path+"/edit/"+t)},n.view=function(t){c.path("/"+n.path+"/view/"+t)},n.openProfile=function(t){viewProfile(p,t)},n.searchKeyup=function(t,e){13==t.keyCode&&n.search(e)},n.search=function(t){n.renderCompleted&&n.goToPage(1,t)},n.changeFilter=function(t){n.findBy=null,n.filter=t.filter,n.filter_title=t.title,n.search()},n.changeFindBy=function(t){n.filter=null,n.findBy=t.findBy,n.filter_title=t.title,n.search()},n.location=c.url(),n.reverse=!0,n.order=function(t,e){n.list=h("orderBy")(n.list,t,e)},n.selectionAll=!1,n.$watch("selectionAll",function(t){n.list&&n.list.forEach(function(e){e.sel=t})}),n.isUnSelected=function(){if(!n.list)return!0;for(var t=0;t<n.list.length;t++){var e=n.list[t];if(e.sel&&1==e.sel)return!1}return!0},n.delete=function(t){t?confirm("Có chắc chắn xóa không?")&&o.delete(id_app,t).success(function(){n.list=_.reject(n.list,function(e){return e._id==t}),l.list=n.list}).error(function(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")}):confirm("Có chắc chắn xóa những dòng đã chọn không?")&&async.map(n.list,function(t,e){if(t.sel&&1==t.sel){var i=t._id;o.delete(id_app,i).success(function(){n.list=_.reject(n.list,function(t){return t._id==i}),e(null,i)}).error(function(t){e(t)})}else e()},function(t){if(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")}else l.list=n.list})},r.initHomeController&&r.initHomeController(e,n,i,o,c,l),id_app&&d.nextTick(function(){var e=server_url+"/api/"+id_app+"/rpt?q={ma_cn:'"+t.toUpperCase()+"'}";i.get(e).success(function(t){n.rpts=t}).error(function(t){console.log(t)})}),n.rptManagement=function(){var e="rpt?ma_cn="+t.toUpperCase();c.url(e)},n.print=function(e){n.list.forEach(function(n){if(n.sel){var i=server_url+"/api/"+id_app+"/"+t+"/excel/"+e+"?_id="+n._id+"&access_token="+d.token;u.open(i)}})},n.import=function(){var e="#"+t+"/import?t=1";if(r.initImport)r.initImport(n,e,function(t,e){if(t)return u.alert(t);var i=0,a=u.open(e,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=s(function(){return"OK"==a.document.title?(n.search(),s.cancel(stop),stop=void 0,void a.close()):"ERROR"==a.document.title?(s.cancel(stop),void(stop=void 0)):(i+=500,void(i>3e5&&stop&&(s.cancel(stop),stop=void 0)))},500)});else{var i=0,a=u.open(e,"Import","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=200");stop=s(function(){return"OK"==a.document.title?(n.search(),s.cancel(stop),stop=void 0,void a.close()):"ERROR"==a.document.title?(s.cancel(stop),void(stop=void 0)):(i+=500,void(i>3e5&&stop&&(s.cancel(stop),stop=void 0)))},500)}},n.follow=function(e){1==e.follow_yn?i.delete(server_url+"/api/"+id_app+"/follow/"+e.followObject._id).success(function(){e.follow_yn=0}).error(function(t){t&&u.alert(t)}):(followObject={id_object:e._id,collection_name:t,id_app:id_app},i.post(server_url+"/api/"+id_app+"/follow",followObject).success(function(t){e.followObject=t,e.follow_yn=1}).error(function(t){t&&u.alert(t)}))},n.isLike=!1,id_app&&(i.get(server_url+"/api/"+id_app+"/like_module?q={module:'"+t+"',user_created:'"+v.email+"'}").success(function(t){t&&1==t.length&&(n.isLike=t[0].like)}).error(function(t){console.log(t)}),n.like=function(){var e=server_url+"/api/"+id_app+"/like_module";i.post(e,{id_app:id_app,module:t,like:!0}).success(function(t){t&&(n.isLike=!0)}).error(function(t){console.log(t)})},n.unlike=function(){var e=server_url+"/api/"+id_app+"/like_module";i.post(e,{id_app:id_app,module:t,like:!1}).success(function(t){t&&(n.isLike=!1)}).error(function(t){console.log(t)})}),n.$on("keydown",function(t,e){return 116==e.which?void n.search():e.ctrlKey&&77==e.which?void n.add():e.ctrlKey&&68==e.which?void n.delete():(e.ctrlKey&&65==e.which&&n.list&&n.list.forEach(function(t){t.sel=!0}),void(e.ctrlKey&&85==e.which&&n.list&&n.list.forEach(function(t){t.sel=!1})))}),n.options=function(){token=d.token;p.open({templateUrl:"templates/"+r.group+"/"+t+"/templates/options.html",controller:["$scope","$controller","$http","$modalInstance","$window",function(e,n,i,a){var o=server_url+"/api/"+id_app+"/options",r={};i.get(o+"?access_token="+token+"&q={id_func:'"+t+"'}").success(function(n){1==n.length?(r=n[0],e.options=r.option):(r.id_app=id_app,r.id_func=t)}).error(function(){console.log(o)}),e.save=function(){r.option=e.options,r._id?i.put(o+"/"+r._id+"?access_token="+token,r).success(function(){a.close()}).error(function(t){alert("Không thể cập nhật tùy chọn\n"+t.toString())}):i.post(o+"?access_token="+token,r).success(function(){a.close()}).error(function(t){alert("Không thể lưu tùy chọn\n"+t.toString())})},e.cancel=function(){a.dismiss("cancel")}}],size:"lg",resolve:{}})}}})}]),this.module.directive(t+"Form",[function(){return{restrict:"E",templateUrl:"templates/"+r.group+"/"+t+"/templates/form.html"}}]),this.module.controller(t+"ImportController",["$scope","$rootScope","$location","$routeParams",t+"Config","appInfo",function(e,n,i,a,o,c){c.info(t,function(t){if(!t){var a=n.token;n.hide_nav=!0,e.action=server_url+"/api/"+id_app+"/"+r.server_path+"/import/excel?access_token="+a,e.template="templates/templates/"+r.code+".xlsx";var o=i.search();o.values&&(e.action=e.action+"&values="+o.values),o.update&&(e.action=e.action+"&update="+o.update)}})}]),this.module.controller(t+"AddController",["$controller","$scope","$http",t,"$location",t+"Config","$rootScope","$modal","$window","appInfo",function(e,n,i,o,c,l,d,u,s,p){n.masterData={status:!0},n.data={status:!0,visible_to:0},n.$modal=u,n.$http=i,n.$window=s,r.defaultValues&&(_.extend(n.data,r.defaultValues),_.extend(n.masterData,r.defaultValues));var h=c.search();h&&(_.extend(n.data,h),_.extend(n.masterData,h)),r.init&&r.init(n,e),n.action="Thêm mới",p.info(t,function(t){if(!t){n.current_user=d.user,n.isDataLoaded=!0,angular.extend(n,l),a.onAdd&&d.nextTick(function(){a.onAdd(n,{$controller:e,$rootScope:d,$http:i,service:o,$location:c,config:l,$window:s,$modal:u})}),n.reset=function(){n.data=angular.copy(n.masterData)},n.cancel=function(){var t=c.search().redirect;t?"back"==t?s.history.back():c.url(t):c.url("/"+n.path)},n.isUnchanged=function(){return angular.equals(n.data,n.masterData)};var _=function(){n.$emit("$dataSaveStart"),o.create(id_app,n.data).success(function(t){n.masterData=t,l.list||(l.list=[]),l.list.push(n.masterData);var e=c.search().redirect;e?"back"==e?s.history.back():c.url(e):a.has_view?c.url("/"+n.path+"/view/"+t._id):c.path("/"+n.path),n.$emit("$dataSaveSuccess")}).error(function(t){n.$emit("$dataSaveError");var e=t;e.indexOf("Lỗi")<0&&(e.indexOf("duplicate")>=0?e="Lỗi: Đã tồn tại":e.indexOf("Not allowed")>=0&&(e="Lỗi: Bạn không có quyền thực hiện thao tác này")),alert(angular.isArray(e)?e.join("\n"):e)})};n.create=function(){a.onSave?a.onSave(n,n.data,{action:"CREATE",$controller:e,$rootScope:d,$http:i,service:o,$location:c,config:l,$window:s,$modal:u},function(t,e){return t?s.alert(t):void(e&&_())}):_()},n.$on("keydown",function(t,e){e.ctrlKey&&83==e.which&&n.create()}),r.initAddController&&r.initAddController(e,n,i,o,c,l)}})}]),this.quickadd=function(e,n,i){e.open({templateUrl:"templates/"+r.group+"/"+t+"/templates/dialog-quickadd.html",controller:["$scope","$controller","$http",t,"$location",t+"Config","$modalInstance","$window","$rootScope",function(t,o,c,l,d,u,s,p,h){if(t.masterData={status:!0},t.data={status:!0,visible_to:0},t.isDataLoaded=!0,t.$modal=e,t.$http=c,t.$window=p,t.action="Thêm mới",r.init&&r.init(t,o),r.defaultValues&&_.extend(t.data,r.defaultValues),i)for(var f in i)t.data[f]=i[f];var g=d.search();g&&(_.extend(t.data,g),_.extend(t.masterData,g)),angular.extend(t,u),r.initAddController&&r.initAddController(o,t,c,l,d,u),t.isUnchanged=function(){return angular.equals(t.data,t.masterData)},a.onAdd&&h.nextTick(function(){a.onAdd(t,{$controller:o,$rootScope:h,$http:c,service:l,$location:d,config:u,$window:p,$modal:e})});var m=function(){t.$emit("$dataSaveStart"),l.create(id_app,t.data).success(function(e){t.masterData=e,u.list||(u.list=[]),u.list.push(t.masterData),n&&n(t.masterData),s.close(),t.$emit("$dataSaveSuccess")}).error(function(e){t.$emit("$dataSaveError");var n=e;n.indexOf("Lỗi")<0&&(n.indexOf("duplicate")>=0?n="Lỗi: Đã tồn tại":n.indexOf("Not allowed")>=0&&(n="Lỗi: Bạn không có quyền thực hiện thao tác này")),alert(angular.isArray(n)?n.join("\n"):n)})};t.create=function(){a.onSave?a.onSave(t,t.data,{action:"CREATE",$controller:o,$rootScope:h,$http:c,service:l,$location:d,config:u,$window:p,$modal:e},function(t,e){return t?p.alert(t):void(e&&m())}):m()},t.cancel=function(){s.dismiss("cancel")}}],size:"lg",backdrop:"static",resolve:{}})},this.quickedit=function(e,n,i){e.open({templateUrl:"templates/"+r.group+"/"+t+"/templates/dialog-quickadd.html",controller:["$scope","$controller","$http",t,"$location",t+"Config","$modalInstance","$window","$routeParams","$timeout","$rootScope",function(t,o,c,l,d,u,s,p,h,f,g){t.data={},r.init&&r.init(t,o),g.nextTick(function(){l.get(id_app,n).success(function(m){if(!m)return p.alert("Đối tượng này không tồn tại\nid:"+n),void s.dismiss("cancel");t.masterData=m,_.extend(t.data,m),t.$modal=e,t.$http=c,t.$window=p,t.action="Sửa",r.loadItem&&r.loadItem(t,t.data),f(function(){t.isDataLoaded=!0},100),angular.extend(t,u),t.isUnchanged=function(){return angular.equals(t.data,t.masterData)},a.onEdit&&g.nextTick(function(){a.onEdit(t,{$controller:o,$rootScope:g,$http:c,service:l,$location:d,config:u,$window:p,$modal:e})});var v=function(){t.$emit("$dataSaveStart"),l.update(id_app,n,t.data).success(function(e){for(var n in e)t.masterData[n]=e[n];i&&i(t.masterData),s.close(),t.$emit("$dataSaveSuccess")}).error(function(e){t.$emit("$dataSaveError");var n=JSON.stringify(e);if(n.indexOf("Lỗi")<0){if(n.indexOf("duplicate")>=0)return n="Lỗi: Đã tồn tại",alert(n);if(n.indexOf("Not allowed")>=0)return n="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(n)}n=JSON.parse(n),alert(angular.isArray(n)?n.join("\n"):n)})};t.create=function(){a.onSave?a.onSave(t,t.data,{action:"UPDATE",$controller:o,$rootScope:g,$http:c,service:l,$location:d,config:u,$window:p,$modal:e},function(t,e){return t?p.alert(t):void(e&&v())}):v()},t.cancel=function(){s.dismiss("cancel")},r.initEditController&&r.initEditController(o,t,c,l,d,h,u,f)}).error(function(t){alert(t.indexOf("Lỗi")>=0?t:"Không thể tìm thấy đối tượng này"),s.dismiss("cancel")})})}],size:"lg",backdrop:"static",resolve:{}})},this.module.controller(t+"EditController",["$controller","$scope","$http",t,"$location","$routeParams",t+"Config","$timeout","$rootScope","$modal","$window","appInfo",function(e,n,i,o,c,l,d,u,s,p,h,f){n.masterData=null,n.data={},n.$modal=p,n.$http=i,n.$window=h,n.action="Sửa",angular.extend(n,d),r.init&&r.init(n,e),f.info(t,function(t){if(!t){n.current_user=s.user,d.list&&(n.masterData=_.find(d.list,function(t){return t._id==l.id})),n.openProfile=function(t){viewProfile(p,t)},n.masterData?(n.data=angular.copy(n.masterData),r.loadItem&&r.loadItem(n,n.data),a.onEdit&&s.nextTick(function(){a.onEdit(n,{$controller:e,$http:i,service:o,$location:c,config:d,$window:h,$modal:p})}),u(function(){n.isDataLoaded=!0},100)):(n.masterData={},s.nextTick(function(){n.$emit("$dataChangeStart"),o.get(id_app,l.id).success(function(t){n.masterData=t,n.data=angular.copy(n.masterData),d.list||(d.list=[]),d.list.push(n.masterData),r.loadItem&&r.loadItem(n,n.data),a.onEdit&&s.nextTick(function(){a.onEdit(n,{$controller:e,$rootScope:s,$http:i,service:o,$location:c,config:d,$window:h,$modal:p})}),u(function(){n.isDataLoaded=!0,n.$emit("$dataChangeSuccess")},100)}).error(function(t){n.$emit("$dataChangeError"),alert(t.indexOf("Lỗi")>=0?t:"Không thể tìm thấy đối tượng này")})})),n.isUnchanged=function(){return angular.equals(n.data,n.masterData)},n.reset=function(){n.data=angular.copy(n.masterData)},n.cancel=function(){var t=c.search().redirect;t?"back"==t?h.history.back():c.url(t):c.url(a.has_view?"/"+n.path+"/view/"+n.data._id:"/"+n.path)},n.$on("keydown",function(t,e){e.ctrlKey&&83==e.which&&n.create()});var f=function(){n.$emit("$dataSaveStart"),o.update(id_app,l.id,n.data).success(function(t){for(var e in t)n.masterData[e]=t[e];var i=c.search().redirect;i?"back"==i?h.history.back():c.url(i):a.has_view?c.url("/"+n.path+"/view/"+t._id):c.path("/"+n.path),n.$emit("$dataSaveSuccess")}).error(function(t){n.$emit("$dataSaveError");var e=JSON.stringify(t);if(e.indexOf("Lỗi")<0){if(e.indexOf("duplicate")>=0)return e="Lỗi: Đã tồn tại",alert(e);if(e.indexOf("Not allowed")>=0)return e="Lỗi: Bạn không có quyền thực hiện thao tác này",alert(e)}e=JSON.parse(e),alert(angular.isArray(e)?e.join("\n"):e)})};n.create=function(){a.onSave?a.onSave(n,n.data,{action:"UPDATE",$controller:e,$rootScope:s,$http:i,service:o,$location:c,config:d,$window:h,$modal:p},function(t,e){return t?h.alert(t):void(e&&f())}):f()},r.initEditController&&r.initEditController(e,n,i,o,c,l,d,u)}})}]),this.module.controller(t+"ViewController",["$controller","$scope","$routeParams",t+"Config",t,"$rootScope","$location","$window","$http","$modal","appInfo","$localStorage","$interval",function(e,n,i,o,r,c,l,d,u,s,p,h,f){p.info(t,function(p){if(!p){n.code=t,n.location=l.url(),n.current_user=c.user,n.action="Xem",n.current_record=0,n.total_records=0,angular.extend(n,o);var g=function(){c.nextTick(function(){n.$emit("$dataChangeStart"),r.get(id_app,i.id).success(function(t){n.data=t,n.data.links=[],id_app&&u.get(server_url+"/api/"+id_app+"/follow?q={id_object:'"+t._id+"',user_created:'"+n.current_user.email+"'}").success(function(e){e&&e.length>0?(t.followObject=e[0],t.follow_yn=1):t.follow_yn=0}).error(function(){t.follow_yn=0}),a.onView&&a.onView(n,{$controller:e,$http:u,service:r,$location:l,config:o,$window:d,$modal:s,$rootScope:c,$localStorage:h,$interval:f}),n.$emit("$dataChangeSuccess")}).error(function(t){t&&alert(t),n.$emit("$dataChangeError"),l.url("/"+n.path)})})};if(n.list)for(var m=0;m<n.list.length;m++)if(n.list[m]._id==i.id){n.current_record=m,n.total_records=n.list.length-1,n.data=n.list[n.current_record],n.data.links=[],a.onView&&a.onView(n,{$controller:e,$http:u,service:r,$location:l,config:o,$window:d,$modal:s,$rootScope:c,$localStorage:h,$interval:f});break}n.data||g(),n.back=function(){var t=l.search().redirect;t?"back"==t?d.history.back():l.url(t):l.url("/"+n.path)},n.update=function(t,e){var i={};_.extend(i,n.data),t&&_.extend(i,t),r.update(id_app,n.data._id,i).success(function(t){_.extend(n.data,t),e&&e(null,t)}).error(function(t){e?e(t):t&&d.alert(t)})},n.edit=function(){l.url("/"+t+"/edit/"+i.id)},n.add=function(){var t="/"+n.path+"/add";l.path(t)},n.backRecord=function(){if(n.current_record>0){n.current_record=n.current_record-1;var e=n.list[n.current_record]._id;l.path(t+"/view/"+e)}},n.nextRecord=function(){if(n.list&&n.current_record<n.total_records){n.current_record=n.current_record+1;var e=n.list[n.current_record]._id;l.path(t+"/view/"+e)}},n.delete=function(t){confirm("Có chắc chắn xóa không?")&&r.delete(id_app,t).success(function(){o.list=_.reject(o.list,function(e){return e._id==t});var e=l.search().redirect;e?"back"==e?d.history.back():l.url(e):l.url("/"+n.path)}).error(function(t){var e;e=_.isObject(t)?JSON.stringify(t):t,alert(e.indexOf("Lỗi:")>=0?e:"Không thể xóa")})},n.openProfile=function(t){viewProfile(s,t)},n.follow=function(){1==n.data.follow_yn?u.delete(server_url+"/api/"+id_app+"/follow/"+n.data.followObject._id).success(function(){n.data.follow_yn=0}).error(function(t){t&&d.alert(t)}):(followObject={id_object:n.data._id,collection_name:t,id_app:id_app},u.post(server_url+"/api/"+id_app+"/follow",followObject).success(function(t){n.data.followObject=t,n.data.follow_yn=1}).error(function(t){t&&d.alert(t)}))},n.$on("keydown",function(t,e){if(116==e.which)return void g();if(e.ctrlKey){if(69==e.which)return void n.edit();if(77==e.which)return void n.add()}}),n.addLink=function(e,i){var a={};a.id_a=n.data._id,a.collection_a=t,a.collection_b=e.collection_name,a.id_b=e._id;var o=server_url+"/api/"+id_app+"/link";u.post(o,a).success(function(t){_.extend(a,t),a.obj=e,a.collection_obj=e.collection_name,a.title=e[i],n.data.links.push(a)}).error(function(t){console.log(t);var o={id_a:a.id_a,id_b:a.id_b};u.get(server_url+"/api/"+id_app+"/link?q="+JSON.stringify(o)).success(function(t){t.length>0&&(_.extend(a,t[0]),a.obj=e,a.collection_obj=e.collection_name,a.title=e[i],n.data.links.push(a))}).error(function(t){console.error(t)})})}}})}]),this.module.config(["$routeProvider","$locationProvider",function(e){e.when("/"+t,{templateUrl:"templates/"+r.group+"/"+t+"/templates/list.html",controller:t+"HomeController"}).when("/"+t+"/add",{templateUrl:"templates/"+r.group+"/"+t+"/templates/edit.html",controller:t+"AddController"}).when("/"+t+"/json",{templateUrl:"templates/sys/json.html",controller:t+"JsonController"}).when("/"+t+"/import",{templateUrl:"templates/sys/import.html",controller:t+"ImportController"}).when("/"+t+"/edit/:id",{templateUrl:"templates/"+r.group+"/"+t+"/templates/edit.html",controller:t+"EditController"}).when("/"+t+"/view/:id",{templateUrl:"templates/"+r.group+"/"+t+"/templates/view.html",controller:t+"ViewController"})}]),this.initModule&&this.initModule(this.module)};
//# sourceMappingURL=baseInput.min.js.map