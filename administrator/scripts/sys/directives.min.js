accApp.directive("format",["$filter",function(t){return{require:"?ngModel",scope:{ngModel:"="},controller:["$scope",function(t){t.$watch("ngModel",function(e){void 0==e&&(t.ngModel=0)})}],link:function(e,n,o,i){i&&(i.$formatters.unshift(function(){return(void 0==i.$modelValue||""==i.$modelValue)&&(i.$modelValue=0),t(o.format)(i.$modelValue)}),i.$parsers.unshift(function(e){(void 0==e||""==e)&&(e="0");var o=e.replace(/[^\d|\-+|,+]/g,""),i=o.replace(/,/g,"."),c=t("number")(i);o.indexOf(",")==o.length-1&&(c+=","),n.val(c);var a=Number(i);return void 0==a&&(a=0),a}))}}}]),accApp.directive("ngData",function(){return{controller:["$scope",function(){}]}}),accApp.directive("ngSum",function(){return{scope:{ngSum:"@",ngData:"=",ngModel:"="},link:function(t){t.$watch("ngData",function(e){var n=0;e&&angular.forEach(e,function(e){var o=Number(e[t.ngSum]);n+=o}),t.ngModel=n},!0)}}}),accApp.directive("ngDatepicker",["$window",function(){return{restrict:"E",require:"^ngModel",scope:{ngModel:"=",ngChange:"&"},templateUrl:"templates/sys/ng-datepicker.html",controller:["$scope","$filter",function(t){t.$watch("ngModel",function(e,n){e&&!_.isDate(e)&&(t.ngModel=new Date(e)),t.ngChange&&e!=n&&t.ngChange()})}],link:function(){}}}]),accApp.directive("ngRequiredCn",["dmtk",function(t){var e=!1,n=function(t,n){1!=e||n.$viewValue&&""!=n.$viewValue?n.$setValidity("ngRequiredCn",!0):n.$setValidity("ngRequiredCn",!1)};return{restrict:"A",require:"?ngModel",link:function(o,i,c,a){o.$watch(c.ngRequiredCn,function(i){i?o.tks?(e=_.filter(o.tks,function(t){return t.tk==i&&t.tk_cn}).length>0,n(o,a)):t.list(id_app,{tk:i,tk_cn:!0},"tk_cn").success(function(t){e=0==t.length?!1:!0,n(o,a)}):(e=!1,n(o,a))}),o.$watch(c.ngModel,function(){n(o,a)})}}}]),accApp.directive("ngRequiredQ",[function(){return{restrict:"A",require:"?ngModel",link:function(t,e,n,o){t.$watch(n.ngRequiredQ,function(t){t?o.$setValidity("ngRequired",!1):o.$setValidity("ngRequired",!0)})}}}]),accApp.directive("topMenu",[function(){return{restrict:"E",templateUrl:"templates/sys/top-menu.html",controller:["$scope","$rootScope","colleague","$window","user","app","$location","$http","appInfo","$timeout",function(t,e,n,o,i,c,a,r){e.notifies_count=0,e.messages_count=0,e.task_count=0,e.getMessages=function(t){e.msgs=[{content:"Đang lấy dữ liệu..."}],i.getMessagesColleagues(function(n,o){n?(e.messages_count=0,e.msgs=[{content:"Không thể lấy dữ liệu từ server"}]):(e.msgs=o,e.messages_count=o.length,t&&t(o))})},e.getInvitations=function(t){e.notifies={notifications:[{content:"Đang lấy dữ liệu..."}]},i.getNotifies(function(n,o){n?(e.notifies_count=0,e.notifies={notifications:[{content:"Không thể lấy dữ liệu từ server"}]}):(e.notifies=o,e.notifies_count=o.colls.length+o.apps.length+o.notifications.length,t&&t(o))})},e.getTask=function(){e.tasks=[{ten_cv:"Đang lấy dữ liệu..."}];var t=new Date,n={progress:{$ne:2},start_date:{$lt:t},status:!0,phu_trach:e.user.email};r.get(server_url+"/api/"+id_app+"/task?fields=ten_cv,percent,progress,priority&q="+JSON.stringify(n)).success(function(t){e.tasks=t,e.task_count=t.length}).error(function(){e.tasks=[{ten_cv:"Không thể lấy dữ liệu từ server"}]})},e.acceptInvitor=function(t,e){"colleague"==t&&n.active(e).success(function(){(0==a.url().indexOf("/colleague")||0==a.url().indexOf("colleague"))&&o.location.reload()}).error(function(){alert("Không thể thực hiện thao tác này")}),"app"==t&&c.active(e).success(function(){(0==a.url().indexOf("/app")||0==a.url().indexOf("app"))&&o.location.reload()}).error(function(){alert("Không thể thực hiện thao tác này")})},e.notAcceptInvitor=function(t,e){"colleague"==t&&n.notaccept(e).success(function(){(0==a.url().indexOf("/colleague")||0==a.url().indexOf("colleague"))&&o.location.reload()}).error(function(){alert("Không thể thực hiện thao tác này")}),"app"==t&&c.notaccept(e).success(function(){(0==a.url().indexOf("/app")||0==a.url().indexOf("app"))&&o.location.reload()}).error(function(){alert("Không thể thực hiện thao tác này")})}}]}}]),accApp.directive("horizantalMenu",[function(){return{restrict:"E",templateUrl:"templates/sys/horizantal-menu.html"}}]),accApp.directive("appHeader",[function(){return{restrict:"E",templateUrl:"templates/sys/app-header.html"}}]),accApp.directive("ngPage",[function(){return{restrict:"E",templateUrl:"templates/sys/ng-page.html"}}]),accApp.directive("ngPageFx",[function(){return{restrict:"E",scope:{service:"=",list:"=",condition:"=",start:"=",pageChanged:"&"},templateUrl:"templates/sys/ng-page.html",controller:["$scope","$http","$rootScope",function(t,e,n){t.current_page=1,t.getPages=function(){t.service.load(id_app,{condition:t.condition,count:1}).success(function(e){t.total_page=Math.round(e.rows_number/t.limit,0),t.total_page<e.rows_number/t.limit&&(t.total_page+=1),0==t.total_page&&(t.total_page=1),t.pages=[];for(var n=1;n<=t.total_page;n++)t.pages.push(n)})},t.goToPage=function(o){o||(o=1),n.nextTick(function(){t.$emit("$dataChangeStart"),t.service.load(id_app,{condition:t.condition,page:o,limit:t.limit,fields:t.fields}).success(function(n){async.map(n,function(n,o){t.emailCurrentUser?e.get(server_url+"/api/follow?q={id_object:'"+n._id+"',user_created:'"+t.emailCurrentUser+"'}").success(function(t){t&&t.length>0?(n.followObject=t[0],n.follow_yn=1):n.follow_yn=0,o()}).error(function(t){n.follow_yn=0,o(t)}):o()},function(e){e&&console.log(e),t.$emit("$dataChangeSuccess"),t.current_page=o,t.pageChanged({$page:o}),t.list=n})}).error(function(){t.$emit("$dataChangeError")})})}}],link:function(t,e,n){t.total_page=1,t.pages=[1],n.hasOwnProperty("emailCurrentUser")&&(t.emailCurrentUser=n.emailCurrentUser),t.fields=n.hasOwnProperty("fields")?n.fields:"",n.hasOwnProperty("limit")&&(t.limit=n.limit),t.current_page=n.hasOwnProperty("currentPage")?Number(n.currentPage):1,t.limit||(t.limit=20),t.$watch("start",function(e){e&&(t.getPages(),t.goToPage(t.current_page),t.start=null)})}}}]),accApp.directive("stplistheader",["$location",function($location){return{restrict:"E",transclude:!0,templateUrl:"templates/sys/list-header.html",link:function(scope,elem,attrs,contr){scope.boxSearch=attrs.hasOwnProperty("boxSearch")?attrs.boxSearch:!0,attrs.hasOwnProperty("btnadd")?(btnAdd=eval("({"+attrs.btnadd+"})"),void 0==btnAdd.show&&(btnAdd.show=!0),void 0==btnAdd.text&&(btnAdd.text="Mới"),scope.add_show=btnAdd.show,scope.add_text=btnAdd.text):(scope.add_show=!0,scope.add_text="Mới"),attrs.btndelete?(btnDelete=eval("({"+attrs.btndelete+"})"),void 0==btnDelete.show&&(btnDelete.show=!0),void 0==btnDelete.text&&(btnDelete.text="Xóa"),scope.delete_show=btnDelete.show,scope.delete_text=btnDelete.text):(scope.delete_text="Xóa",scope.delete_show=!0),attrs.btn1&&(btn1=eval("({"+attrs.btn1+"})"),scope.btn1_show=!0,scope.btn1_text=btn1.text,scope.btn1_title=btn1.title,_.isFunction(btn1.click)&&(scope.btn3_click=btn1.click)),attrs.btn2&&(btn2=eval("({"+attrs.btn2+"})"),scope.btn2_show=!0,scope.btn2_text=btn2.text,scope.btn2_title=btn2.title,_.isFunction(btn2.click)&&(scope.btn2_click=btn2.click)),attrs.btn3&&(btn3=eval("({"+attrs.btn3+"})"),scope.btn3_show=!0,scope.btn3_text=btn3.text,scope.btn3_title=btn3.title,_.isFunction(btn3.click)&&(scope.btn3_click=btn3.click)),attrs.btn4&&(btn4=eval("({"+attrs.btn4+"})"),scope.btn4_show=!0,scope.btn4_text=btn4.text,scope.btn4_title=btn4.title,_.isFunction(btn4.click)&&(scope.btn4_click=btn4.click)),attrs.btn5&&(btn5=eval("({"+attrs.btn5+"})"),scope.btn5_show=!0,scope.btn5_text=btn5.text,scope.btn5_title=btn5.title,_.isFunction(btn5.click)&&(scope.btn5_click=btn5.click)),attrs.btnimport&&(btnimport=eval("({"+attrs.btnimport+"})"),scope.import_show=!0,scope.import_text="Nhập từ Excel")}}}]),accApp.directive("listViewHeader",["$location",function(){return{restrict:"E",transclude:!0,templateUrl:"templates/sys/list-view-header.html",controller:["$scope","$rootScope",function(t,e){t.$watch("data",function(n){n&&(t.title_view=n[t.headerTitleField],e.title_view=t.title_view)})}],link:function(t,e,n){t.headerTitleField=n.headerTitle}}}]),accApp.directive("stpvoucherheader",function(){return{restrict:"E",transclude:!0,templateUrl:"templates/sys/voucher-header.html",link:function(scope,elem,attrs,control){attrs.btn1&&(btn1=eval("({"+attrs.btn1+"})"),scope.btn1_show=!0,scope.btn1_text=btn1.text,scope.btn1_title=btn1.title,_.isFunction(btn1.click)&&(scope.btn1_click=btn1.click)),attrs.btn2&&(btn2=eval("({"+attrs.btn2+"})"),scope.btn2_show=!0,scope.btn2_text=btn2.text,scope.btn2_title=btn2.title,_.isFunction(btn2.click)&&(scope.btn2_click=btn2.click)),attrs.btn3&&(btn3=eval("({"+attrs.btn3+"})"),scope.btn3_show=!0,scope.btn3_text=btn3.text,scope.btn3_title=btn3.title,_.isFunction(btn3.click)&&(scope.btn3_click=btn3.click)),attrs.btn4&&(btn4=eval("({"+attrs.btn4+"})"),scope.btn4_show=!0,scope.btn4_text=btn4.text,scope.btn4_title=btn4.title,_.isFunction(btn4.click)&&(scope.btn4_click=btn4.click)),attrs.btn5&&(btn5=eval("({"+attrs.btn5+"})"),scope.btn5_show=!0,scope.btn5_text=btn5.text,scope.btn5_title=btn5.title,_.isFunction(btn5.click)&&(scope.btn5_click=btn5.click)),attrs.options&&(options=eval("({"+attrs.options+"})"),scope.options_show=!0,scope.options_text=options.text)}}}),accApp.directive("headerFormInput",function(){return{restrict:"E",templateUrl:"templates/sys/header-form-input.html",link:function(t,e,n){n.saveText&&(t.save_text=n.saveText),n.cancelText&&(t.cancel_text=n.cancelText)}}}),accApp.directive("headerDialogSelect",function(){return{restrict:"E",templateUrl:"templates/sys/header-dialog-select.html",link:function(t,e,n){t.title=n.hasOwnProperty("title")?n.title:"Danh sách",t.placeholder=n.hasOwnProperty("placeholder")?n.placeholder:"Gõ từ cần tìm..."}}}),accApp.directive("footerFormInput",function(){return{restrict:"E",templateUrl:"templates/sys/footer-form-input.html",link:function(t,e,n){n.saveText&&(t.save_text=n.saveText),n.cancelText&&(t.cancel_text=n.cancelText)}}}),accApp.directive("rptHeader",["$location",function($location){return{restrict:"E",transclude:!0,templateUrl:"templates/sys/rpt-header.html",link:function(scope,elem,attrs,controller){attrs.kbm&&(scope.kbm_yn=!0,scope.openKbm=function(){$location.url(attrs.kbm)}),scope.btnok_text="Xem",scope.btnok_show=!0,attrs.btnok&&(btnok=eval("({"+attrs.btnok+"})"),btnok.text&&(scope.btnok_text=btnok.text),btnok.show&&(scope.btnok_show=btnok.show)),attrs.btn1&&(btn1=eval("({"+attrs.btn1+"})"),scope.btn1_show=!0,scope.btn1_text=btn1.text,scope.btn1_title=btn1.title,_.isFunction(btn1.click)&&(scope.btn1_click=btn1.click)),attrs.btn2&&(btn2=eval("({"+attrs.btn2+"})"),scope.btn2_show=!0,scope.btn2_text=btn2.text,scope.btn2_title=btn2.title,_.isFunction(btn2.click)&&(scope.btn2_click=btn2.click)),attrs.btn3&&(btn3=eval("({"+attrs.btn3+"})"),scope.btn3_show=!0,scope.btn3_text=btn3.text,scope.btn3_title=btn3.title,_.isFunction(btn3.click)&&(scope.btn3_click=btn3.click)),attrs.btn4&&(btn4=eval("({"+attrs.btn4+"})"),scope.btn4_show=!0,scope.btn4_text=btn4.text,scope.btn4_title=btn4.title,_.isFunction(btn4.click)&&(scope.btn4_click=btn4.click)),attrs.btn5&&(btn5=eval("({"+attrs.btn5+"})"),scope.btn5_show=!0,scope.btn5_text=btn5.text,scope.btn5_title=btn5.title,_.isFunction(btn5.click)&&(scope.btn5_click=btn5.click)),attrs.btnprint?(btnprint=eval("({"+attrs.btnprint+"})"),void 0==btnprint.show&&(btnprint.show=!0),scope.btnprint_show=btnprint.show):scope.btnprint_show=!0,attrs.btnexcel?(btnexcel=eval("({"+attrs.btnexcel+"})"),void 0==btnexcel.show&&(btnexcel.show=!0),scope.btnexcel_show=btnexcel.show):scope.btnexcel_show=!0}}}]),accApp.directive("navbarPrint",function(){return{restrict:"E",templateUrl:"templates/sys/navbar-print.html"}}),accApp.directive("ngTypeahead",["$http",function($http){return{restrict:"E",scope:{ngModel:"=",ngDisabled:"=",ngShow:"=",label:"=",onSelect:"&",fieldModel:"@",module:"@",conditionData:"="},template:function(t,e){var n="<span class='input-group'>";return n+="<input type='text'",n+=" ng-blur='blur()' ng-change='label=undefined' typeahead-on-select = 'getItem($item, $model, $label)'",e.hasOwnProperty("ngRequired")&&(n=n+" ng-required='"+e.ngRequired+"'"),e.hasOwnProperty("ngDisabled")&&(n+=" ng-disabled='ngDisabled'"),e.hasOwnProperty("ngShow")&&(n+=" ng-show='ngShow'"),n=e.hasOwnProperty("group")?n+"typeahead-min-length='3' typeahead-template-url='templates/"+e.group+"/"+e.module+"/templates/typeahead.html' ":n+"typeahead-min-length='3' typeahead-template-url='templates/lists/"+e.module+"/templates/typeahead.html' ",e.hasOwnProperty("placeholder")&&(n=n+" placeholder='"+e.placeholder+"' "),n+=" ng-model='ngModel'",n=n+" typeahead='item."+e.fieldModel+" as item."+e.fieldModel+" for item in getList($viewValue,10)' class='form-control'>",(void 0==e.showButtonList||1==e.showButtonList)&&(n+="<span class='btn input-group-addon'  ng-click='showList()'",e.hasOwnProperty("ngDisabled")&&(n+=" ng-disabled='ngDisabled'"),n+="><i class='fa fa-list'></i></span>"),n+="</span>"},controller:["$scope","$modal","$window","$interval",function($scope,$modal,$window,$interval){var module=eval("("+$scope.module+"Module)");$scope.pathService=module.server_path,$scope.fieldsSearch=module.fields_find;var list=function(t,e,n,o){if(_.contains(paths_not_require_id_app,$scope.pathService))var i=server_url+"/api/"+$scope.pathService+"?t=1";else var i=server_url+"/api/"+t+"/"+$scope.pathService+"?t=1";if(o&&(i=i+"&limit="+o),e)if(angular.isObject(e)){var c=JSON.stringify(e);i=i+"&q="+c}else i=i+"&"+e;return!n&&$scope.fields&&(n=$scope.fields),n&&(i=i+"&fields="+n),$http.get(i)};$scope.prepareCondition=function(value){var condition={};return $scope.condition&&_.extend(condition,$scope.condition),condition.$or=[],$scope.fieldsSearch.forEach(function(field){f=eval(0==field.toLowerCase().indexOf("tk")?"({"+field+":{$regex:'^"+value+"',$options:'i'}})":"({"+field+":{$regex:'"+value+"',$options:'i'}})"),condition.$or.push(f)}),condition},$scope.getList=function(t,e,n){var o=$scope.prepareCondition(t);return list(id_app,o,null,e).then(function(t){var e=t.data;return n&&n(e),e})},$scope.getItem=function(t){$scope.fieldLabel&&($scope.label=t[$scope.fieldLabel]),$scope.onSelect&&$scope.onSelect({$item:t})},$scope.blur=function(){if($scope.ngModel&&!$scope.label&&$scope.fieldLabel){var condition=eval("({"+$scope.fieldModel+":'"+$scope.ngModel+"'})");list(id_app,condition,$scope.fieldLabel).success(function(t){1==t.length?$scope.label=t[0][$scope.fieldLabel]:$scope.ngModel=void 0})}},$scope.showList=function(){$modal.open({templateUrl:"templates/"+$scope.group+"/"+$scope.module+"/templates/dialog-select.html",controller:["$scope","$modalInstance","parentScope",function(t,e,n){t.getList=function(e,o){n.getList(e,o,function(e){t.items=e})},t.keyup=function(e,n){13==e.keyCode&&n&&t.getList(n)},t.select=function(t){n.ngModel=t[n.fieldModel],n.fieldLabel&&(n.label=t[n.fieldLabel]),n.onSelect&&n.onSelect({$item:t}),e.close()},t.cancel=function(){e.dismiss("cancel")},t.openList=function(){{var t="#/"+n.module;$window.open(t,"Danh mục","width="+$window.innerWidth.toString()+",height=400")}e.dismiss("cancel")},t.quickadd=function(){module.quickadd($modal,function(t){n.ngModel=t[n.fieldModel],n.fieldLabel&&(n.label=t[n.fieldLabel])},n.defaultValues),e.dismiss("cancel")},t.getList("",10)}],size:"lg",resolve:{parentScope:function(){return $scope}}})}}],link:function(scope,elem,attrs,controller){var conditionData={};scope.conditionData&&(conditionData=scope.conditionData),attrs.hasOwnProperty("condition")&&(scope.condition=eval("({"+attrs.condition+"})")),attrs.hasOwnProperty("fields")&&(scope.fields=attrs.fields),attrs.hasOwnProperty("fieldLabel")&&(scope.fieldLabel=attrs.fieldLabel),scope.defaultValues=attrs.hasOwnProperty("defaultValues")?eval("({"+attrs.defaultValues+"})"):{},scope.group=attrs.hasOwnProperty("group")?attrs.group:"lists",scope.$watch("ngModel",function(){scope.ngModel||(scope.label="")})}}}]),accApp.factory("$cache_lists",function(){return{}}),accApp.directive("ngSelector",["$http","$cache_lists",function($http,$cache){return{restrict:"E",scope:{ngModel:"=",ngChange:"&",onSelect:"&",ngDisabled:"=",module:"@",fields:"@",fieldModel:"@",fieldLabel:"@",conditionData:"="},template:function(elem,attrs){var html="";if(attrs.hasOwnProperty("button")){var button=eval("({"+attrs.button+"})");button.class||(button.class="btn btn-default"),button.text||(button.text="..."),html=html+"<a class='"+button.class+"'  ng-click='showList()'>"+button.text+"</a>"}else html="<span>",(void 0==attrs.showButtonList||1==attrs.showButtonList)&&(html="<span class='input-group'>"),html+="<select ng-model='ngModel' ng-disabled ='ngDisabled'  ",html=attrs.hasOwnProperty("options")?html+' ng-options="'+attrs.options+'"':attrs.hasOwnProperty("showCode")?html+' ng-options="item.'+attrs.fieldModel+" as item."+attrs.fieldModel+" + ' - ' +  item."+attrs.fieldLabel+'  for item in items" ':html+' ng-options="item.'+attrs.fieldModel+" as item."+attrs.fieldLabel+'  for item in items" ',attrs.hasOwnProperty("multiple")&&(html+=" multiple"),html+=" class='form-control'></select>",(void 0==attrs.showButtonList||1==attrs.showButtonList)&&(html+="<span class='btn input-group-addon'  ng-click='showList()'",attrs.hasOwnProperty("ngDisabled")&&(html+=" ng-disabled='ngDisabled'"),html+="><i class='fa fa-list'></i></span>"),html+="</span>";return html},controller:["$scope","$modal","$window","$interval",function($scope,$modal,$window,$interval){var module=eval("("+$scope.module+"Module)");$scope.pathService=module.server_path,$scope.fieldsSearch=module.fields_find,$scope.$watch("ngModel",function(t){if(t&&$scope.items){var e=_.find($scope.items,function(e){return e[$scope.fieldModel]==t});$scope.ngChange({$item:e}),$scope.onSelect&&$scope.onSelect({$item:e})}else $scope.ngChange({$item:null})}),$scope.list=function(t,e,n,o){if(_.contains(paths_not_require_id_app,$scope.pathService))var i=server_url+"/api/"+$scope.pathService+"?t=1";else var i=server_url+"/api/"+t+"/"+$scope.pathService+"?t=1";if(o&&(i=i+"&limit="+o),e)if(angular.isObject(e)){var c=JSON.stringify(e);i=i+"&q="+c}else i=i+"&"+e;return!n&&$scope.fields&&(n=$scope.fields),n&&(i=i+"&fields="+n),$http.get(i)},$scope.refresh=function(){var condition={status:!0};$scope.condition&&_.extend(condition,$scope.condition),$scope.list(id_app,condition).success(function(data){if(!$scope.condition){var key=$scope.module+"_"+id_app;$cache[key]=data}if($scope.items=[],$scope.emptyYn){var empty_item=eval("({"+$scope.fieldModel+":'',"+$scope.fieldLabel+":'"+$scope.headerText+"'})");$scope.items.push(empty_item)}angular.forEach(data,function(t){$scope.items.push(t)}),!$scope.ngModel&&$scope.items.length>0&&($scope.ngModel=$scope.items[0][$scope.fieldModel])})},$scope.showList=function(){var modalInstance=$modal.open({templateUrl:"templates/"+$scope.group+"/"+$scope.module+"/templates/dialog-select.html",controller:["$scope","$modalInstance","parentScope",function($scope,$modalInstance,parentScope){$scope.getList=function(value,limit){var condition={};parentScope.condition&&_.extend(condition,parentScope.condition),condition.$or=[],parentScope.fieldsSearch.forEach(function(field){var f=eval("({"+field+":{$regex:'"+value+"',$options:'i'}})");condition.$or.push(f)}),parentScope.list(id_app,condition,null,limit).then(function(t){$scope.items=t.data})},$scope.keyup=function(t,e){13==t.keyCode&&e&&$scope.getList(e)},$scope.getList("",10),$scope.select=function(t){parentScope.ngModel=parentScope.multiple?[t[parentScope.fieldModel]]:t[parentScope.fieldModel],parentScope.fieldLabel&&(parentScope.label=t[parentScope.fieldLabel]),parentScope.onSelect&&parentScope.onSelect({$item:t}),$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openList=function(){var t="#/"+parentScope.module,e=$window.open(t,"Danh mục","width="+$window.innerWidth.toString()+",height=400"),n=$interval(function(){e.closed&&(parentScope.refresh(),$interval.stop(n))},100);$modalInstance.dismiss("cancel")},$scope.quickadd=function(){module.quickadd($modal,function(t){parentScope.items.push(t),parentScope.ngModel=parentScope.multiple?[t[parentScope.fieldModel]]:t[parentScope.fieldModel],parentScope.fieldLabel&&(parentScope.label=t[parentScope.fieldLabel]),parentScope.onSelect&&parentScope.onSelect({$item:t});var e=parentScope.module+"_"+id_app;$cache[e]&&$cache[e].push(t)},parentScope.defaultValues),$modalInstance.dismiss("cancel")}}],size:"lg",resolve:{parentScope:function(){return $scope}}})},$scope.getList=function(){var key=$scope.module+"_"+id_app;if($cache[key]&&!$scope.condition&&$scope.cache){var data=$cache[key];if($scope.items=[],$scope.emptyYn){var empty_item=eval("({"+$scope.fieldModel+":'',"+$scope.fieldLabel+":'"+$scope.headerText+"'})");$scope.items.push(empty_item)}angular.forEach(data,function(t){$scope.items.push(t)}),!$scope.ngModel&&$scope.items.length>0&&($scope.ngModel=$scope.items[0][$scope.fieldModel])}else $scope.refresh()}}],link:function(scope,elem,attrs){var conditionData={};scope.conditionData&&(conditionData=scope.conditionData),attrs.hasOwnProperty("condition")&&(scope.condition=eval("({"+attrs.condition+"})")),scope.cache=attrs.hasOwnProperty("cache")?attrs.cache:!1,scope.headerText=attrs.hasOwnProperty("headerText")?attrs.headerText:"--",attrs.hasOwnProperty("multiple")&&(scope.multiple=attrs.multiple),scope.defaultValues=attrs.hasOwnProperty("defaultValues")?eval("({"+attrs.defaultValues+"})"):{},scope.group=attrs.hasOwnProperty("group")?attrs.group:"lists",scope.emptyYn=attrs.hasOwnProperty("ngRequired")||attrs.hasOwnProperty("required")?!1:!0,scope.getList()}}}]),accApp.directive("stpLink",function(){return{restrict:"E",scope:{link:"=",collection:"@",collectionsLink:"@"},templateUrl:"templates/sys/link.html",controller:["$scope","$http","$window","$location",function($scope,$http,$window,$location){$scope.textSearch="",$scope.location=$location.url();var collectionsLink=eval("({"+$scope.collectionsLink+"})"),collections=_.keys(collectionsLink),collectionsTitle={};collections.forEach(function(c){var module_name=c+"Module",module=eval("("+module_name+")");collectionsTitle[c]=module.title}),$scope.collectionsTitleString=_.values(collectionsTitle).join(),$scope.load=function(){var t=server_url+"/api/"+id_app+"/linkslist?_id="+$scope.link._id+"&collections="+collections.join();$http.get(t).success(function(t){$scope.link.links=t}).error(function(t){t&&$window.alert(t)})},$scope.getHeaderCollection=function(t){return collectionsTitle[t.collection_obj]},$scope.search=function(t){var e=server_url+"/api/"+id_app+"/search?collections="+$scope.collectionsLink+"&value="+t;return $http.get(e).then(function(t){var e=t.data;return e})},$scope.addLink=function(t){$scope.textSearch="";var e=_.find($scope.link.links,function(e){return e.obj._id==t._id});if(!e){var n={};n.id_a=$scope.link._id,n.collection_a=$scope.collection,n.collection_b=t.collection_name,n.collection_obj=t.collection_name,n.id_b=t._id;var o=server_url+"/api/"+id_app+"/link";$http.post(o,n).success(function(e){_.extend(n,e),n.obj=t,n.title=t.title,$scope.link.links.push(n)}).error(function(t){t&&$window.alert(t)})}},$scope.unLink=function(t){var e=server_url+"/api/"+id_app+"/link/"+t._id;$http.delete(e).success(function(){$scope.link.links=_.reject($scope.link.links,function(e){return e._id==t._id})}).error(function(t){t&&$window.alert(t)})},$scope.getItem=function(t,e,n){$scope.addLink(t,n)}}],link:function(t,e,n){n.link&&n.collection&&n.collectionsLink||console.error("stp-link directive require attributes:link,collection,collection-link"),t.$watch("link",function(e){e&&(t.link.links||(t.link.links=[]),t.load())})}}}),accApp.directive("ngGetInfo",["$http",function($http){return{restrict:"A",scope:{conditionValue:"=",runWhenConditionChanged:"=",ngModel:"="},controller:["$scope",function(t){var e=function(e,n,o){var i=server_url+"/api/"+e+"/"+t.pathService+"?t=1";if(n)if(angular.isObject(n)){var c=JSON.stringify(n);i=i+"&q="+c}else i=i+"&"+n;return o&&(i=i+"&fields="+o),$http.get(i)};t.getValue=function(n){var o={};for(var i in t.condition){var c=t.condition[i];o[i]="???"==c?t.conditionValue:c}e(id_app,o,t.fieldInfo).success(function(e){1==e.length&&n(e[0][t.fieldInfo])})}}],link:function(scope,elem,attrs){var ngGetInfo=eval("({"+attrs.ngGetInfo+"})");scope.fieldInfo=ngGetInfo.fieldInfo;var module=eval("("+ngGetInfo.module+"Module)");scope.pathService=module.server_path,scope.condition=ngGetInfo.condition,attrs.hasOwnProperty("runWhenConditionChanged")||(scope.runWhenConditionChanged=!0),scope.$watch("conditionValue",function(t){return scope.runWhenConditionChanged?t?void(scope.fieldInfo&&scope.getValue(function(t){scope.ngModel=t})):void(scope.ngModel=null):void 0})}}}]),accApp.directive("history",function(){return{restrict:"E",scope:{link:"=",module:"@",actions:"@"},templateUrl:"templates/sys/history.html",controller:["$scope","$http","$modal",function($scope,$http,$modal){var module=eval("("+$scope.module+"Module)");$scope.getHistory=function(){var t=server_url+"/api/"+id_app+"/"+module.server_path+"/history/"+$scope.link._id;$scope.actions&&(t=t+"?actions="+$scope.actions),$http.get(t).success(function(t){t.forEach(function(t){t.action_text="GET"==t.action?"Đã xem":"UPDATE"==t.action?"Đã cập nhật":"ADD"==t.action?"Đã tạo":t.action}),$scope.history=t}).error(function(t){console.error(t)})},$scope.openProfile=function(t){viewProfile($modal,t)}}],link:function(t){t.$watch("link",function(e){e&&t.getHistory()})}}}),accApp.directive("parseHtml",function(){return{restrict:"A",scope:{parseHtml:"="},link:function(t,e){t.$watch("parseHtml",function(t){if(t){var n=/<[a-z][\s\S]*>/i.test(t);e.html(n?t:t.replace(/\n/g,"<br/>"))}})}}}),accApp.directive("parseText",function(){return{restrict:"A",scope:{parseText:"=",limit:"@"},link:function(t,e){t.$watch("parseText",function(n){if(n){var o,i=/<[a-z][\s\S]*>/i.test(n);i?(e.html(n),o=e.text()):o=n,t.limit&&o.length>Number(t.limit)&&(o=o.substring(0,t.limit)+"..."),e.text(o)}})}}}),accApp.directive("textcomplete",["Textcomplete",function(t){return{restrict:"EA",scope:{members:"=",message:"="},template:"<textarea class=\"form-control\" rows=\"5\" ng-model='message' type='text'></textarea>",link:function(e,n){e.$watch("members",function(o){if(o&&o.length>0){var i=e.members,c=n.find("textarea"),a=new t(c,[{match:/(^|\s)@(\w*)$/,search:function(t,e){e($.map(i,function(e){return 0===e.toLowerCase().indexOf(t.toLowerCase())?e:null}))},index:2,replace:function(t){return"$1@"+t+" "}}]);$(a).on({"textComplete:select":function(t,n){e.$apply(function(){e.message=n})},"textComplete:show":function(){$(this).data("autocompleting",!0)},"textComplete:hide":function(){$(this).data("autocompleting",!1)}})}})}}}]),accApp.directive("routeLoader",function(){return{restrict:"EA",link:function(t,e){function n(){e.css("display","none")}var o=e.css("display");t.$on("$routeChangeStart",function(){e.css("display",o)}),t.$on("$routeChangeSuccess",n),t.$on("$routeChangeError",n),n()}}}),accApp.directive("serverLoader",function(){return{restrict:"EA",link:function(t,e){function n(){e.css("display","none")}var o=e.css("display");t.$on("$dataChangeStart",function(){t.serverAction="Đang tải dữ liệu",e.css("display",o)}),t.$on("$dataSaveStart",function(){t.serverAction="Đang lưu dữ liệu",e.css("display",o)}),t.$on("$dataChangeSuccess",n),t.$on("$dataChangeError",n),t.$on("$dataSaveSuccess",n),t.$on("$dataSaveError",n),n()}}}),accApp.directive("fileUploadProgress",function(){return{restrict:"EA",link:function(t,e){function n(){e.css("display","none")}var o=e.css("display");t.$on("$fileUploadStart",function(){t.serverAction="Đang tải dữ liệu",e.css("display",o)}),t.$on("$fileUploadSuccess",n),t.$on("$fileUploadError",n),n()}}}),accApp.directive("follow",function(){return{restrict:"E",scope:{collectionsFollow:"@"},templateUrl:"templates/sys/follow.html",controller:["$scope","$rootScope","$http","appInfo",function(t,e,n,o){t.load=function(){o.info("follow",function(e,o,i){if(t.follows=[],!e&&i._id){if(!t.collectionsFollow||!i)return;var c=server_url+"/api/"+i._id+"/follow?q={user_created:'"+o.email+"'}&collections="+t.collectionsFollow;n.get(c).success(function(e){t.follows=e})}})}}],link:function(t){t.load()}}}),accApp.directive("like",function(){return{restrict:"E",scope:{},templateUrl:"templates/sys/like.html",controller:["$scope","$rootScope","$http","appInfo",function(t,e,n,o){t.load=function(){o.info("like_module",function(e,o,i){if(t.likes=[],!e&&i._id){var c=server_url+"/api/"+i._id+"/like_module?q={user_created:'"+o.email+"',like:true}";n.get(c).success(function(e){t.likes=e})}})}}],link:function(t){t.load()}}}),accApp.directive("shortcut",["$document","$rootScope",function(t,e){return{restrict:"A",link:function(){t.bind("keydown",function(t){(t.ctrlKey&&(65==t.which||77==t.which||78==t.which||68==t.which||69==t.which||80==t.which||85==t.which||83==t.which)||116==t.which)&&t.preventDefault(),e.$apply(function(){e.$broadcast("keydown",t)})})}}}]);
//# sourceMappingURL=directives.min.js.map